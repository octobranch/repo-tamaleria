<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Gesti√≥n Integral</title>
    <link rel="stylesheet" href="admin.css">
    <!-- Firebase 9 Modular -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getFirestore, doc, getDoc, collection, query, where, onSnapshot, addDoc, updateDoc, deleteDoc, Timestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, signOut, updatePassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

        // TODO: Reemplaza con tus credenciales de Firebase
        const firebaseConfig = {
            apiKey: "TU_API_KEY",
            authDomain: "TU_DOMAIN.firebaseapp.com",
            projectId: "TU_PROJECT_ID",
            storageBucket: "TU_STORAGE_BUCKET",
            messagingSenderId: "TU_SENDER_ID",
            appId: "TU_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        window.firebase = {
            db, auth, doc, getDoc, collection, query, where, onSnapshot,
            addDoc, updateDoc, deleteDoc, Timestamp, signInWithEmailAndPassword, signOut,
            updatePassword, onAuthStateChanged
        };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="admin-container">
        <!-- Autenticaci√≥n -->
        <div class="auth-container" id="authContainer">
            <div class="auth-box">
                <h2>Acceso Administrador</h2>
                <div class="input-group">
                    <label for="email">Correo electr√≥nico:</label>
                    <input type="email" id="email" autocomplete="username" required>
                </div>
                <div class="input-group">
                    <label for="password">Contrase√±a:</label>
                    <input type="password" id="password" autocomplete="current-password" required>
                </div>
                <button id="loginBtn" class="primary-btn">Ingresar</button>
                <div id="authMessage" class="auth-message"></div>
                <div class="security-info">
                    <p>üîí Conexi√≥n segura mediante Firebase Auth</p>
                </div>
            </div>
        </div>

        <!-- Dashboard y Panel Principal -->
        <div class="dashboard-container" id="dashboardContainer" style="display:none;">

            <header class="admin-header">
                <div class="header-title">
                    <h1>Panel de Administraci√≥n</h1>
                    <p id="userRole"></p>
                </div>
                <div class="header-actions">
                    <button id="refreshBtn" class="icon-btn" title="Actualizar">
                        <svg aria-hidden="true" viewBox="0 0 24 24"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                    </button>
                    <button id="profileBtn" class="icon-btn" title="Cambiar Contrase√±a">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-.99 1.97-3.08 6-3.08 4.03 0 5.97 2.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
                    </button>
                    <button id="logoutBtn" class="icon-btn" title="Cerrar sesi√≥n">
                        <svg aria-hidden="true" viewBox="0 0 24 24"><path d="M10.09 15.59L11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/></svg>
                    </button>
                </div>
            </header>

            <main class="admin-main">
                <aside class="admin-sidebar">
                    <nav>
                        <ul>
                            <li data-section="inventory">Inventario</li>
                            <!-- Otros roles podrian tener otros list items aqui -->
                            <li data-section="promotions">Promociones</li>
                            <li data-section="reports">Reportes</li>
                        </ul>
                    </nav>
                </aside>

                <section class="content-area">

                    <!-- Secci√≥n de Inventario -->
                    <div id="inventorySection" class="dashboard-section" style="display: none;">
                        <div class="inventory-controls">
                            <div class="search-container">
                                <input type="text" id="searchInput" placeholder="Buscar insumo...">
                            </div>
                            <button id="addItemBtn" class="primary-btn">‚ûï Nuevo Insumo</button>
                            <button id="exportPdfBtn" class="secondary-btn">Exportar a PDF</button>
                        </div>

                        <div class="inventory-table-container">
                            <table class="inventory-table">
                                <thead>
                                    <tr>
                                        <th data-sort="name">Nombre</th>
                                        <th data-sort="quantity">Cantidad</th>
                                        <th data-sort="unit">Unidad</th>
                                        <th data-sort="costPrice">Precio Costo</th>
                                        <th data-sort="supplier">Proveedor</th>
                                        <th data-sort="expirationDate">Caducidad</th>
                                        <th data-sort="category">Categor√≠a</th>
                                        <th data-sort="location">Ubicaci√≥n</th>
                                        <th data-sort="notes">Notas</th>
                                        <th data-sort="lastUpdate">√öltima actualizaci√≥n</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="inventoryList"></tbody>
                            </table>
                            <div id="loadingIndicator" class="loading-indicator">
                                <div class="spinner"></div>
                                <p>Cargando inventario...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de Promociones -->
                      <div id="promotionsSection" class="dashboard-section" style="display: none;">
                        <h2>Gesti√≥n de Promociones (WIP)</h2>
                        <p>Aqu√≠ podr√°s gestionar las promociones.</p>
                        </div>

                    <!-- Secci√≥n de Reportes -->
                       <div id="reportsSection" class="dashboard-section" style="display: none;">
                        <h2>Reportes (WIP)</h2>
                        <p>Aqu√≠ podr√°s generar y ver los reportes.</p>
                       </div>

                </section>
            </main>
        </div>
    </div>

    <!-- Modales -->
    <!-- Modal de Insumo -->
    <div id="itemModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Gestionar Insumo</h3>
                <button class="close-btn" onclick="AdminUI.closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="itemForm">
                    <div class="form-group">
                        <label for="itemName">Nombre:</label>
                        <input type="text" id="itemName" required>
                    </div>
                    <div class="form-group">
                        <label for="itemDescription">Descripci√≥n:</label>
                        <textarea id="itemDescription"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="itemQuantity">Cantidad:</label>
                        <input type="number" id="itemQuantity" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="itemUnit">Unidad de medida:</label>
                        <select id="itemUnit" required>
                            <option value="">Seleccionar...</option>
                            <option value="kg">Kilogramos</option>
                            <option value="g">Gramos</option>
                            <option value="l">Litros</option>
                            <option value="unidades">Unidades</option>
                        </select>
                    </div>
                     <div class="form-group">
                        <label for="itemCostPrice">Precio de Costo:</label>
                        <input type="number" id="itemCostPrice" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="itemSupplier">Proveedor:</label>
                        <input type="text" id="itemSupplier">
                    </div>
                    <div class="form-group">
                        <label for="itemExpirationDate">Fecha de Caducidad:</label>
                        <input type="date" id="itemExpirationDate">
                    </div>
                    <div class="form-group">
                        <label for="itemCategory">Categor√≠a:</label>
                        <input type="text" id="itemCategory">
                    </div>
                    <div class="form-group">
                        <label for="itemLocation">Ubicaci√≥n:</label>
                        <input type="text" id="itemLocation">
                    </div>
                    <div class="form-group">
                        <label for="itemNotes">Notas:</label>
                        <textarea id="itemNotes"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="secondary-btn" onclick="AdminUI.closeModal()">Cancelar</button>
                        <button type="submit" class="primary-btn">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de cambio de contrase√±a -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Cambiar Contrase√±a</h3>
                <button class="close-btn" onclick="AdminUI.closePasswordModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="passwordForm">
                    <div class="form-group">
                        <label for="newPassword">Nueva Contrase√±a:</label>
                        <input type="password" id="newPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirmar Nueva Contrase√±a:</label>
                        <input type="password" id="confirmPassword" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="secondary-btn" onclick="AdminUI.closePasswordModal()">Cancelar</button>
                        <button type="submit" class="primary-btn">Guardar Contrase√±a</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="admin.js"></script>
</body>
</html>
