<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Gesti√≥n Integral</title>
    <link rel="stylesheet" href="admin.css">
    <!-- Firebase 9 Modular -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getFirestore, doc, getDoc, collection, query, where, onSnapshot, addDoc, updateDoc, deleteDoc, Timestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, signOut, updatePassword, updateEmail, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

        // TODO: Reemplaza con tus credenciales de Firebase
       const firebaseConfig = {
  apiKey: "AIzaSyC8yt-0Ha8igI_vEXhybu0wNs5th-mnWK0",
  authDomain: "la-tamaleria-cancun-47590.firebaseapp.com",
  projectId: "la-tamaleria-cancun-47590",
  storageBucket: "la-tamaleria-cancun-47590.firebasestorage.app",
  messagingSenderId: "130225049824",
  appId: "1:130225049824:web:5d361078bcf42e7c20c085"
};

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        window.firebase = {
            db, auth, doc, getDoc, collection, query, where, onSnapshot,
            addDoc, updateDoc, deleteDoc, Timestamp, signInWithEmailAndPassword, signOut,
            updatePassword, updateEmail, onAuthStateChanged
        };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
     <!-- Import Chart.js library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="admin-container">
        <!-- Autenticaci√≥n -->
        <div class="auth-container" id="authContainer">
            <div class="auth-box">
                <h2>Acceso Administrador</h2>
                <div class="input-group">
                    <label for="email">Correo electr√≥nico:</label>
                    <input type="email" id="email" autocomplete="username" required>
                </div>
                <div class="input-group">
                    <label for="password">Contrase√±a:</label>
                    <input type="password" id="password" autocomplete="current-password" required>
                </div>
                <button id="loginBtn" class="primary-btn">Ingresar</button>
                <div id="authMessage" class="auth-message"></div>
                <div class="security-info">
                    <p>üîí Conexi√≥n segura mediante Firebase Auth</p>
                </div>
            </div>
        </div>

        <!-- Dashboard y Panel Principal -->
        <div class="dashboard-container" id="dashboardContainer" style="display:none;">

            <header class="admin-header">
                <div class="header-title">
                    <h1>Panel de Administraci√≥n</h1>
                    <p id="userRole"></p>
                </div>
                <div class="header-actions">
                      <a href="https://octobranch.github.io/repo-tamaleria/" class="icon-btn" title="Regresar al sitio web" target="_blank">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
                    </a>
                    <button id="profileBtn" class="icon-btn" title="Configuraci√≥n de perfil">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-.99 1.97-3.08 6-3.08 4.03 0 5.97 2.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
                    </button>
                    <button id="logoutBtn" class="icon-btn" title="Cerrar sesi√≥n">
                        <svg aria-hidden="true" viewBox="0 0 24 24"><path d="M10.09 15.59L11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/></svg>
                    </button>
                </div>
            </header>

            <main class="admin-main">
                <aside class="admin-sidebar">
                    <nav>
                         <ul>
                            <li data-section="dashboard">Dashboard</li>
                            <li data-section="inventory">Inventario</li>
                            <li data-section="promotions">Promociones</li>
                            <li data-section="reports">Reportes</li>
                        </ul>
                    </nav>
                </aside>

                <section class="content-area">

                     <!-- Secci√≥n de Dashboard -->
                    <div id="dashboardSection" class="dashboard-section"  style="display: none;">
                         <h2>Panel de Control</h2>
                        <div class="dashboard-metrics">
                            <div class="metric-card">
                                <h3>Total de Insumos</h3>
                                <p id="totalItems">Cargando...</p>
                            </div>
                            <div class="metric-card">
                                <h3>Valor Total del Inventario</h3>
                                <p id="totalValue">Cargando...</p>
                            </div>
                             <div class="metric-card">
                                <h3>Total Visitas</h3>
                                <p id="totalVisits">Cargando...</p>
                            </div>
                             <div class="metric-card">
                                <h3>Total Page Views</h3>
                                <p id="totalPageViews">Cargando...</p>
                             </div>
                            <!-- Agrega m√°s m√©tricas aqu√≠ -->
                        </div>
                    </div>

                    <!-- Secci√≥n de Inventario -->
                    <div id="inventorySection" class="dashboard-section" style="display: none;">
                        <div class="inventory-controls">
                            <div class="search-container">
                                <input type="text" id="searchInput" placeholder="Buscar insumo...">
                            </div>
                            <button id="addItemBtn" class="primary-btn">‚ûï Nuevo Insumo</button>
                            <button id="exportPdfBtn" class="secondary-btn">Exportar a PDF</button>
                        </div>

                        <div class="inventory-table-container">
                            <table class="inventory-table">
                                <thead>
                                    <tr>
                                        <th data-sort="name">Nombre</th>
                                        <th data-sort="quantity">Cantidad</th>
                                        <th data-sort="unit">Unidad</th>
                                        <th data-sort="costPrice">Precio Costo</th>
                                        <th data-sort="supplier">Proveedor</th>
                                        <th data-sort="expirationDate">Caducidad</th>
                                        <th data-sort="category">Categor√≠a</th>
                                        <th data-sort="location">Ubicaci√≥n</th>
                                        <th data-sort="notes">Notas</th>
                                        <th data-sort="lastUpdate">√öltima actualizaci√≥n</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="inventoryList"></tbody>
                            </table>
                            <div id="loadingIndicator" class="loading-indicator">
                                <div class="spinner"></div>
                                <p>Cargando inventario...</p>
                            </div>
                        </div>
                    </div>

                     <!-- Secci√≥n de Promociones -->
                    <div id="promotionsSection" class="dashboard-section" style="display: none;">
                        <h2>Gesti√≥n de Promociones</h2>
                        <div class="promotion-controls">
                            <button id="addPromotionBtn" class="primary-btn">‚ûï Nueva Promoci√≥n</button>
                        </div>
                        <div class="promotion-list-container">
                            <table class="promotion-table">
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Descripci√≥n</th>
                                        <th>Descuento</th>
                                        <th>Fecha de Inicio</th>
                                        <th>Fecha de Fin</th>
                                        <th>Activa</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="promotionList"></tbody>
                            </table>
                        </div>
                    </div>

                     <!-- Secci√≥n de Reportes -->
                    <div id="reportsSection" class="dashboard-section" style="display: none;">
                        <h2>Reportes</h2>
                        <div class="report-controls">
                            <label for="reportType">Tipo de Reporte:</label>
                            <select id="reportType">
                                <option value="sales">Ventas</option>
                                <option value="inventory">Inventario</option>
                            </select>
                            <label for="reportDateRange">Rango de Fechas:</label>
                            <input type="date" id="reportStartDate">
                            <input type="date" id="reportEndDate">
                            <button id="generateReportBtn" class="primary-btn">Generar Reporte</button>
                        </div>

                        <div class="report-chart-container">
                            <canvas id="reportChart"></canvas>
                        </div>
                    </div>

                </section>
            </main>
        </div>
    </div>

    <!-- Modales -->
    <!-- Modal de Insumo -->
    <div id="itemModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Gestionar Insumo</h3>
                <button class="close-btn" onclick="AdminUI.closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="itemForm">
                    <div class="form-group">
                        <label for="itemName">Nombre:</label>
                        <input type="text" id="itemName" required>
                    </div>
                    <div class="form-group">
                        <label for="itemDescription">Descripci√≥n:</label>
                        <textarea id="itemDescription"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="itemQuantity">Cantidad:</label>
                        <input type="number" id="itemQuantity" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="itemUnit">Unidad de medida:</label>
                        <select id="itemUnit" required>
                            <option value="">Seleccionar...</option>
                            <option value="kg">Kilogramos</option>
                            <option value="g">Gramos</option>
                            <option value="l">Litros</option>
                            <option value="unidades">Unidades</option>
                        </select>
                    </div>
                     <div class="form-group">
                        <label for="itemCostPrice">Precio de Costo:</label>
                        <input type="number" id="itemCostPrice" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="itemSupplier">Proveedor:</label>
                        <input type="text" id="itemSupplier">
                    </div>
                    <div class="form-group">
                        <label for="itemExpirationDate">Fecha de Caducidad:</label>
                        <input type="date" id="itemExpirationDate">
                    </div>
                    <div class="form-group">
                        <label for="itemCategory">Categor√≠a:</label>
                        <input type="text" id="itemCategory">
                    </div>
                    <div class="form-group">
                        <label for="itemLocation">Ubicaci√≥n:</label>
                        <input type="text" id="itemLocation">
                    </div>
                    <div class="form-group">
                        <label for="itemNotes">Notas:</label>
                        <textarea id="itemNotes"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="secondary-btn" onclick="AdminUI.closeModal()">Cancelar</button>
                        <button type="submit" class="primary-btn">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de Perfil -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Configuraci√≥n de Perfil</h3>
                <button class="close-btn" onclick="AdminUI.closeProfileModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="profileForm">
                    <div class="form-group">
                        <label for="newEmail">Nuevo Correo Electr√≥nico:</label>
                        <input type="email" id="newEmail">
                    </div>
                    <div class="form-group">
                        <label for="newPassword">Nueva Contrase√±a:</label>
                        <input type="password" id="newPassword">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="secondary-btn" onclick="AdminUI.closeProfileModal()">Cancelar</button>
                        <button type="submit" class="primary-btn">Guardar Cambios</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de cambio de contrase√±a -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Cambiar Contrase√±a</h3>
                <button class="close-btn" onclick="AdminUI.closePasswordModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="passwordForm">
                    <div class="form-group">
                        <label for="newPassword">Nueva Contrase√±a:</label>
                        <input type="password" id="newPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirmar Nueva Contrase√±a:</label>
                        <input type="password" id="confirmPassword" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="secondary-btn" onclick="AdminUI.closePasswordModal()">Cancelar</button>
                        <button type="submit" class="primary-btn">Guardar Contrase√±a</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de Promoci√≥n -->
    <div id="promotionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Gestionar Promoci√≥n</h3>
                <button class="close-btn" onclick="AdminUI.closePromotionModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="promotionForm">
                    <div class="form-group">
                        <label for="promotionName">Nombre:</label>
                        <input type="text" id="promotionName" required>
                    </div>
                    <div class="form-group">
                        <label for="promotionDescription">Descripci√≥n:</label>
                        <textarea id="promotionDescription"></textarea>
                    </div>
                     <div class="form-group">
                        <label for="promotionDiscount">Descuento:</label>
                        <input type="number" id="promotionDiscount" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="promotionStartDate">Fecha de Inicio:</label>
                        <input type="date" id="promotionStartDate">
                    </div>
                     <div class="form-group">
                        <label for="promotionEndDate">Fecha de Fin:</label>
                        <input type="date" id="promotionEndDate">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="secondary-btn" onclick="AdminUI.closePromotionModal()">Cancelar</button>
                        <button type="submit" class="primary-btn">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="admin.js"></script>
</body>
</html>
